{"version":3,"sources":["webpack:///src/pages/bmap/BMapComponent.vue","webpack:///./src/pages/bmap/BMapComponent.vue?3f64","webpack:///./src/pages/bmap/BMapComponent.vue"],"names":["BMapComponent","data","cellName","myDis","allPoints","points","bm","convertor","planTable","NeiplanResult","ploygonStyle","strokeColor","strokeWeight","strokeOpacity","fillColor","fillOpacity","opts","ploygonStyle_1","ploygonStyle_2","bs","isShowAllTable","isShowPlanTable","created","sessionStorage","getItem","this","setpname_prom","getTable","window","addEventListener","setItem","mounted","_this","$nextTick","initMap","console","log","methods","extends_default","Object","vuex_esm","rangeBtn","open","map","external__BMap__default","a","Map","point","Point","centerAndZoom","BMapLib","DistanceTool","Convertor","enableScrollWheelZoom","addControl","MapTypeControl","mapTypes","BMAP_NORMAL_MAP","BMAP_HYBRID_MAP","self","length","getCounts","draw","Sector1","point2","radius","sDegree","eDegree","strokeColour","Strokepacity","fillColour","step","push","i","EOffsetBearing","point3","dist","bearing","lngConv","getDistance","lng","lat","latConv","Math","sin","PI","cos","addMarker","setInfoWindow","pointItem","infoWindowHtml","key","sContent","InfoWindow","removeMarker","clearOverlays","translateCallback","status","choiceCell","$event","cellItem","cellItems","document","querySelectorAll","classList","remove","target","add","Longitude","Latitude","pointArr","translate","_this2","heads","headers","username","JSON","parse","user","projectname","pname","filetype","$http","post","httppath","neifiletype","then","res","allTable","slice","_this3","getBounds","forEach","item","containsPoint","_this4","len","groupCount","_loop","pos","pointItems","j","_loop2","_i","deg","Dir","oval","Polygon","infoWindow","addOverlay","onclick","e","openInfoWindow","showNeiplan","getNeiplanResult","_this5","servingcell","computed","state","filterPoints","_this6","filter","Cell","match","toUpperCase","isCell","bmap_BMapComponent","render","_vm","_h","$createElement","_c","_self","staticClass","_v","directives","name","rawName","value","expression","attrs","type","placeholder","domProps","on","input","composing","staticStyle","cursor","click","_l","_s","preventDefault","height","id","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/37.4d496aec69cdb60698b8.js","sourcesContent":["<template>\r\n  <div class=\"map-wrapper\">\r\n    <div class=\"map-menu\">\r\n      <p class=\"cell-list-header\">站点列表</p>\r\n      <input type=\"text\"\r\n             name=\"cellName\"\r\n             class=\"searchCell\"\r\n             placeholder=\"请输入搜索内容\"\r\n             v-model=\"cellName\">\r\n      <div class=\"nothingCell\"\r\n           v-if=\"isCell\">没有找到数据</div>\r\n      <ul class=\"cell-list\"\r\n          v-else>\r\n        <li>\r\n          <h3 @click=\"{{isShowAllTable = !isShowAllTable}}\" style=\"cursor: pointer;\">总表</h3>\r\n          <ul class=\"list-item\" v-show=\"isShowAllTable\">\r\n            <li class=\"cell-item\"\r\n              v-for=\"cellItem in filterPoints\"\r\n              @click=\"choiceCell($event,cellItem)\">\r\n              {{cellItem.Cell}}\r\n            </li>\r\n          </ul>\r\n        </li>\r\n        <li>\r\n          <h3 @click=\"{{isShowPlanTable = !isShowPlanTable}}\" style=\"cursor: pointer;\">邻区规划站点</h3>\r\n          <ul class=\"list-item\" v-show=\"isShowPlanTable\">\r\n            <li class=\"cell-item\"\r\n              v-for=\"cellItem in planTable\"\r\n              @click=\"choiceCell($event,cellItem)\">\r\n              {{cellItem.Cell}}\r\n            </li>\r\n          </ul>\r\n        </li>\r\n      </ul>\r\n    </div>\r\n    <div class=\"map-content\">\r\n      <div class=\"toolBar\">\r\n        <div class=\"neiplan\">\r\n          <button @click=\"showNeiplan\">显示规划点位</button>\r\n          <button @click.prevent=\"addMarker\">显示总表</button>\r\n          <button @click=\"getNeiplanResult\">获取邻区规划</button>\r\n        </div>\r\n      </div>\r\n      <div id=\"allmap\"\r\n           style=\"height: 400px;\">\r\n      </div>\r\n      <!-- <div id=\"r-result\">请输入:<input type=\"text\" id=\"suggestId\" size=\"20\" value=\"百度\" style=\"width:150px;\" @highlight=\"\" /></div> -->\r\n      <!-- <div id=\"searchResultPanel\" style=\"border:1px solid #C0C0C0;width:150px;height:auto; display:none;\"></div> -->\r\n      <button @click.prevent=\"rangeBtn\"\r\n              class=\"rangeBtn\">测距</button>\r\n      <button @click.prevent=\"addMarker\"\r\n              class=\"addMarker\">导入数据</button>\r\n      <button @click.prevent=\"removeMarker\"\r\n              class=\"removeMarker\">删除数据</button>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script type=\"text/javascript\">\r\nimport BMap from 'BMap'\r\nimport { mapMutations, mapState } from 'vuex'\r\nexport default {\r\n  data () {\r\n    return {\r\n      cellName: '',\r\n      myDis: null,\r\n      allPoints: [],\r\n      points: [],\r\n      bm: null,\r\n      convertor: null,\r\n      planTable: null,\r\n      NeiplanResult: null,\r\n      // 多边形样式\r\n      ploygonStyle: {\r\n        strokeColor: 'red',\r\n        strokeWeight: 1,\r\n        strokeOpacity: 1,\r\n        fillColor: 'red',\r\n        fillOpacity: 0.5,\r\n        opts: 'hello'\r\n      },\r\n      ploygonStyle_1: {\r\n        strokeColor: 'orange',\r\n        strokeWeight: 1,\r\n        strokeOpacity: 1,\r\n        fillColor: 'orange',\r\n        fillOpacity: 0.5,\r\n        opts: 'hello'\r\n      },\r\n      ploygonStyle_2: {\r\n        strokeColor: 'pink',\r\n        strokeWeight: 1,\r\n        strokeOpacity: 1,\r\n        fillColor: 'pink',\r\n        fillOpacity: 0.5,\r\n        opts: 'hello'\r\n      },\r\n      //可视区域\r\n      bs: null,\r\n      isShowAllTable: true,\r\n      isShowPlanTable: false\r\n    }\r\n  },\r\n  created () {\r\n    if (sessionStorage.getItem('pname')) {\r\n      this.setpname_prom(sessionStorage.getItem('pname'))\r\n    }\r\n    // 获取邻区关系表\r\n    // 获取总表及规划站点\r\n    // 获取总表站点\r\n    this.getTable()\r\n    // 在页面刷新时将vuex里的信息保存到localStorage里\r\n    window.addEventListener('beforeunload', () => {\r\n      sessionStorage.setItem('pname', sessionStorage.getItem('pname'))\r\n    })\r\n  },\r\n  mounted () {\r\n    this.$nextTick(() => {\r\n      this.initMap()\r\n    })\r\n    console.log();\r\n  },\r\n  methods: {\r\n    ...mapMutations(['setpname_prom']),\r\n    // 点击打开测距功能\r\n    rangeBtn () {\r\n      this.myDis.open()\r\n      // 关闭鼠标测\r\n      // myDis.close()\r\n    },\r\n    // 初始化地图\r\n    initMap () {\r\n      // 创建Map实例\r\n      let map = new BMap.Map('allmap')\r\n      this.bm = map\r\n      // 地图初始化\r\n      let point = new BMap.Point(102.772465,24.985747)\r\n      this.bm.centerAndZoom(point, 14)\r\n      this.myDis = new BMapLib.DistanceTool(this.bm)\r\n      // 创建点\r\n      // this.bm.centerAndZoom('昆明', 13)\r\n      // 设置地图显示的城市 此项是必须设置\r\n      // this.bm.setCurrentCity('昆明')\r\n      // 地图坐标转换\r\n      this.convertor = new BMap.Convertor()\r\n      // 开启鼠标滚轮缩放\r\n      this.bm.enableScrollWheelZoom(true)\r\n\r\n      \r\n      // 添加地图类型控件\r\n      this.bm.addControl(new BMap.MapTypeControl({\r\n        mapTypes: [\r\n          BMAP_NORMAL_MAP,\r\n          BMAP_HYBRID_MAP\r\n        ]\r\n      }))\r\n      // 获取当前地图视图\r\n      const self = this\r\n      map.addEventListener(\"dragend\", function(){\r\n        self.points = []\r\n        if (self.allPoints.length) {\r\n          self.getCounts(this)\r\n          self.draw(self.points,self.ploygonStyle)\r\n        }\r\n      })\r\n    },\r\n    // 画出以point2点为圆心，半径为radius，夹角从sDegree到eDegree的扇形\r\n    Sector1 (point2, radius, sDegree, eDegree, strokeColour, strokeWeight, Strokepacity, fillColour, fillOpacity, opts) {\r\n      // 创建构成多边形的点数组\r\n      let points = []\r\n      // 根据扇形的总夹角确定每步夹角度数，最大为10\r\n      let step = ((eDegree - sDegree) / 10) || 10\r\n      points.push(point2)\r\n      // 循环获取每步的圆弧上点的坐标，存入点数组\r\n      for (let i = sDegree; i < eDegree + 0.001; i += step) {\r\n        points.push(this.EOffsetBearing(point2, radius, i))\r\n      }\r\n      points.push(point2)\r\n      return points\r\n    },\r\n    // 使用数学的方法计算需要画扇形的圆弧上的点坐标\r\n    EOffsetBearing (point3, dist, bearing) {\r\n      // 计算1经度与原点的距离\r\n      let lngConv = this.bm.getDistance(point3, new BMap.Point(point3.lng + 0.1, point3.lat)) * 10\r\n      // 计算1纬度与原点的距离\r\n      let latConv = this.bm.getDistance(point3, new BMap.Point(point3.lng, point3.lat + 0.1)) * 10\r\n      // 正弦计算待获取的点的纬度与原点纬度差\r\n      let lat = dist * Math.sin(bearing * Math.PI / 180) / latConv\r\n      // 余弦计算待获取的点的经度与原点经度差\r\n      let lng = dist * Math.cos(bearing * Math.PI / 180) / lngConv\r\n      return new BMap.Point(point3.lng + lng, point3.lat + lat)\r\n    },\r\n    // 批量导入站点\r\n    addMarker () {\r\n      this.getCounts(this.bm)\r\n      this.draw(this.points,this.ploygonStyle)\r\n    },\r\n    // 设置覆盖物信息框内的内容,传入站点信息\r\n    setInfoWindow(pointItem){\r\n      let infoWindowHtml = ''\r\n      for (var key in pointItem) {\r\n        infoWindowHtml += \"<p style='margin:0;line-height:20px;font-size:13px;width:250px'><span style='display:inline-block;width:160px'>\" + key + ':</span>' + pointItem[key] + '</p>'\r\n      }\r\n      let sContent = '<div style=\"height: 100px; overflow-y: scroll;margin-top:10px\">' + infoWindowHtml + '</div>'\r\n      return new BMap.InfoWindow(sContent)\r\n    },\r\n    // 批量删除数据\r\n    removeMarker () {\r\n      this.bm.clearOverlays()\r\n      this.points = []\r\n    },\r\n    // 谷歌坐标转百度\r\n    translateCallback(data){\r\n      if(data.status === 0) {\r\n        this.bm.centerAndZoom(data.points[0], 14)\r\n      }\r\n    },\r\n    // 列表中选中站名后执行\r\n    choiceCell ($event, cellItem) {\r\n      let cellItems = document.querySelectorAll('.cell-item')\r\n      for (var i = cellItems.length - 1; i >= 0; i--) {\r\n        cellItems[i].classList.remove('choiced')\r\n      }\r\n      $event.target.classList.add('choiced')\r\n      // 跳转至对应点位\r\n      let point = new BMap.Point(cellItem.Longitude, cellItem.Latitude)\r\n      var pointArr = []\r\n      pointArr.push(point)\r\n      this.convertor.translate(pointArr, 3, 5, this.translateCallback)\r\n    },\r\n    // 获取所需表格\r\n    getTable(){\r\n      var heads = {\r\n        headers: {\r\n          'username': JSON.parse(sessionStorage.user).username,\r\n          'projectname': sessionStorage.pname,\r\n          'filetype': 'map'\r\n        }\r\n      }\r\n      this.$http.post(\r\n        this.user.httppath + 'api/Geo/GetAllTable?neifiletype=lte',\r\n        { neifiletype: 'lte' },\r\n        heads\r\n      ).then((res)=>{\r\n        \r\n      console.log(res);\r\n        this.allPoints = res.allTable.slice(0,1000)\r\n        this.planTable = res.planTable\r\n      })\r\n    },\r\n    // 获取视区范围,并判断是否在可是在可视区域\r\n    getCounts(map){\r\n      this.bs = map.getBounds()\r\n      this.allPoints.forEach((item)=>{\r\n        let point = new BMap.Point(item.Longitude, item.Latitude)\r\n        if (this.bs.containsPoint(point)) {\r\n          this.points.push(item)\r\n        }\r\n      })\r\n    },\r\n    //\r\n    draw(points,ploygonStyle){\r\n      let bm = this.bm\r\n      let len = points.length\r\n      let groupCount = len / 10 + 1\r\n      \r\n      // 批量撒点只能一次加载10个，所以要分批次加载\r\n      if (groupCount > 1) {\r\n        for (let i = 0; i < groupCount; i++) {\r\n          let pos = []\r\n          let pointItems = []\r\n          for (let j = 0; j < 10; j++) {\r\n            if (i * 10 + j < len) {\r\n              // 设置百度经纬度\r\n              let point = new BMap.Point(points[(i * 10) + j].Longitude, points[(i * 10) + j].Latitude)\r\n              let pointItem = points[(i * 10) + j]\r\n              pos.push(point)\r\n              pointItems.push(pointItem)\r\n            }\r\n          }\r\n          const self = this\r\n          this.convertor.translate(pos, 1, 5, function (data) {\r\n            if (data.status === 0) {\r\n              for (let i = 0; i < data.points.length; i++) {\r\n                let deg = pointItems[i].Dir\r\n                // 画扇形\r\n                // 以画多边形区域的方法画扇形区域 \r\n                let oval = new BMap.Polygon(self.Sector1(data.points[i], 100, -deg + 90 - 20, -deg + 90 + 20), ploygonStyle)\r\n                // 设置覆盖物信息框内的内容,传入站点信息\r\n                let infoWindow = self.setInfoWindow(pointItems[i])\r\n                bm.addOverlay(oval)\r\n                // 点击单个覆盖物时显示信息内容\r\n                oval.onclick = function (e) {\r\n                  bm.openInfoWindow(infoWindow, new BMap.Point(data.points[i].lng, data.points[i].lat))\r\n                }\r\n              }\r\n            }\r\n          })\r\n        }\r\n      }\r\n    },\r\n    showNeiplan(){\r\n      this.draw(this.planTable,this.ploygonStyle_1)\r\n    },\r\n    getNeiplanResult(){\r\n      var heads = {\r\n        headers: {\r\n          'username': JSON.parse(sessionStorage.user).username,\r\n          'projectname': sessionStorage.pname,\r\n          'filetype': 'map'\r\n        }\r\n      }\r\n      this.$http.post(\r\n        this.user.httppath + 'api/Geo/GetNeighborCell?neifiletype=lte',\r\n        {\r\n          servingcell: '713768_02'\r\n        },\r\n        heads\r\n      ).then((res)=>{\r\n        this.NeiplanResult = res\r\n        this.draw(this.NeiplanResult,this.ploygonStyle_2)\r\n      })\r\n    }\r\n  },\r\n  computed: {\r\n    ...mapState({\r\n      user: (state) => state.user\r\n    }),\r\n    filterPoints () {\r\n      return this.allPoints.filter((data) => {\r\n        return data.Cell.match(this.cellName.toUpperCase())\r\n      })\r\n    },\r\n\r\n    // 判断站点容器里是否有内容\r\n    isCell () {\r\n      return this.filterPoints.length === 0\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style type=\"text/css\" scoped>\r\n* {\r\n  margin: 0;\r\n  padding: 0;\r\n}\r\nul,\r\nli {\r\n  list-style-type: none;\r\n}\r\n.map-wrapper {\r\n  margin: 20px 20px;\r\n  display: flex;\r\n}\r\n.map-menu {\r\n  width: 200px;\r\n  margin-right: 20px;\r\n  border: 1px solid #ebeef5;\r\n  border-radius: 5px;\r\n}\r\n.cell-list-header {\r\n  height: 40px;\r\n  line-height: 40px;\r\n  background: #f5f7fa;\r\n  border-bottom: 1px solid #ebeef5;\r\n  padding-left: 10px;\r\n  font-size: 16px;\r\n}\r\n.cell-list {\r\n  padding: 0 10px;\r\n  background: white;\r\n  height: 400px;\r\n  font-size: 15px;\r\n  overflow-y: scroll;\r\n}\r\n.nothingCell {\r\n  padding: 0 10px;\r\n  background: white;\r\n  height: 400px;\r\n  font-size: 15px;\r\n}\r\n.searchCell {\r\n  width: 100%;\r\n  border: 1px solid gray;\r\n  padding: 10px 8px;\r\n  box-sizing: border-box;\r\n  margin: 10px 0;\r\n  border-radius: 10px;\r\n  outline: none;\r\n}\r\n.cell-item.choiced {\r\n  color: #409eff;\r\n}\r\n.cell-item {\r\n  padding-bottom: 5px;\r\n  cursor: pointer;\r\n}\r\n.toolBar{\r\n  line-height: 30px;\r\n}\r\n.map-content {\r\n  width: 500px;\r\n  height: 400px;\r\n  flex: 1;\r\n}\r\nbutton.addMarker,\r\nbutton.removeMarker {\r\n  margin-top: 10px;\r\n  padding: 10px;\r\n}\r\nbutton.rangeBtn {\r\n  position: absolute;\r\n  right: 119px;\r\n  top: 80px;\r\n  border: 1px solid rgb(139, 164, 220);\r\n  background: white;\r\n  padding: 2px 6px;\r\n  font: 12px/1.3em arial, sans-serif;\r\n  text-align: center;\r\n  white-space: nowrap;\r\n  border-radius: 3px 0px 0px 3px;\r\n  color: black;\r\n  outline: none;\r\n  box-shadow: rgba(0, 0, 0, 0.35) 2px 2px 3px;\r\n}\r\n.cell-message-box {\r\n  width: 10px;\r\n  height: 10px;\r\n  background: red;\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n}\r\nimg {\r\n  top: 0;\r\n}\r\n</style>\n\n\n// WEBPACK FOOTER //\n// src/pages/bmap/BMapComponent.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"map-wrapper\"},[_c('div',{staticClass:\"map-menu\"},[_c('p',{staticClass:\"cell-list-header\"},[_vm._v(\"站点列表\")]),_vm._v(\" \"),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.cellName),expression:\"cellName\"}],staticClass:\"searchCell\",attrs:{\"type\":\"text\",\"name\":\"cellName\",\"placeholder\":\"请输入搜索内容\"},domProps:{\"value\":(_vm.cellName)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.cellName=$event.target.value}}}),_vm._v(\" \"),(_vm.isCell)?_c('div',{staticClass:\"nothingCell\"},[_vm._v(\"没有找到数据\")]):_c('ul',{staticClass:\"cell-list\"},[_c('li',[_c('h3',{staticStyle:{\"cursor\":\"pointer\"},on:{\"click\":function($event){{{_vm.isShowAllTable = !_vm.isShowAllTable}}}}},[_vm._v(\"总表\")]),_vm._v(\" \"),_c('ul',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.isShowAllTable),expression:\"isShowAllTable\"}],staticClass:\"list-item\"},_vm._l((_vm.filterPoints),function(cellItem){return _c('li',{staticClass:\"cell-item\",on:{\"click\":function($event){_vm.choiceCell($event,cellItem)}}},[_vm._v(\"\\n            \"+_vm._s(cellItem.Cell)+\"\\n          \")])}),0)]),_vm._v(\" \"),_c('li',[_c('h3',{staticStyle:{\"cursor\":\"pointer\"},on:{\"click\":function($event){{{_vm.isShowPlanTable = !_vm.isShowPlanTable}}}}},[_vm._v(\"邻区规划站点\")]),_vm._v(\" \"),_c('ul',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.isShowPlanTable),expression:\"isShowPlanTable\"}],staticClass:\"list-item\"},_vm._l((_vm.planTable),function(cellItem){return _c('li',{staticClass:\"cell-item\",on:{\"click\":function($event){_vm.choiceCell($event,cellItem)}}},[_vm._v(\"\\n            \"+_vm._s(cellItem.Cell)+\"\\n          \")])}),0)])])]),_vm._v(\" \"),_c('div',{staticClass:\"map-content\"},[_c('div',{staticClass:\"toolBar\"},[_c('div',{staticClass:\"neiplan\"},[_c('button',{on:{\"click\":_vm.showNeiplan}},[_vm._v(\"显示规划点位\")]),_vm._v(\" \"),_c('button',{on:{\"click\":function($event){$event.preventDefault();return _vm.addMarker($event)}}},[_vm._v(\"显示总表\")]),_vm._v(\" \"),_c('button',{on:{\"click\":_vm.getNeiplanResult}},[_vm._v(\"获取邻区规划\")])])]),_vm._v(\" \"),_c('div',{staticStyle:{\"height\":\"400px\"},attrs:{\"id\":\"allmap\"}}),_vm._v(\" \"),_c('button',{staticClass:\"rangeBtn\",on:{\"click\":function($event){$event.preventDefault();return _vm.rangeBtn($event)}}},[_vm._v(\"测距\")]),_vm._v(\" \"),_c('button',{staticClass:\"addMarker\",on:{\"click\":function($event){$event.preventDefault();return _vm.addMarker($event)}}},[_vm._v(\"导入数据\")]),_vm._v(\" \"),_c('button',{staticClass:\"removeMarker\",on:{\"click\":function($event){$event.preventDefault();return _vm.removeMarker($event)}}},[_vm._v(\"删除数据\")])])])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/_vue-loader@13.7.3@vue-loader/lib/template-compiler?{\"id\":\"data-v-713ca58c\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/_vue-loader@13.7.3@vue-loader/lib/selector.js?type=template&index=0!./src/pages/bmap/BMapComponent.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/_extract-text-webpack-plugin@3.0.2@extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/_vue-loader@13.7.3@vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-713ca58c\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../../node_modules/_vue-loader@13.7.3@vue-loader/lib/selector?type=styles&index=0!./BMapComponent.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/_vue-loader@13.7.3@vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/_vue-loader@13.7.3@vue-loader/lib/selector?type=script&index=0!./BMapComponent.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/_vue-loader@13.7.3@vue-loader/lib/selector?type=script&index=0!./BMapComponent.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/_vue-loader@13.7.3@vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-713ca58c\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/_vue-loader@13.7.3@vue-loader/lib/selector?type=template&index=0!./BMapComponent.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-713ca58c\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/pages/bmap/BMapComponent.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}