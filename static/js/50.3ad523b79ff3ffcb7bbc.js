webpackJsonp([50],{"5zib":function(t,e){},qGk0:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("4YfN"),l=n.n(i),a=n("jkKj"),s=n.n(a),o=n("9rMa"),r={data:function(){return{cellName:"",myDis:null,allPoints:[],points:[],bm:null,convertor:null,planTable:null,NeiplanResult:null,ploygonStyle:{strokeColor:"red",strokeWeight:1,strokeOpacity:1,fillColor:"red",fillOpacity:.5,opts:"hello"},ploygonStyle_1:{strokeColor:"orange",strokeWeight:1,strokeOpacity:1,fillColor:"orange",fillOpacity:.5,opts:"hello"},ploygonStyle_2:{strokeColor:"pink",strokeWeight:1,strokeOpacity:1,fillColor:"pink",fillOpacity:.5,opts:"hello"},bs:null,isShowAllTable:!0,isShowPlanTable:!1}},created:function(){sessionStorage.getItem("pname")&&this.setpname_prom(sessionStorage.getItem("pname")),this.getTable(),window.addEventListener("beforeunload",function(){sessionStorage.setItem("pname",sessionStorage.getItem("pname"))})},mounted:function(){var t=this;this.$nextTick(function(){t.initMap()}),console.log(this.user)},methods:l()({},Object(o.d)(["setpname_prom"]),{rangeBtn:function(){this.myDis.open()},initMap:function(){var t=new s.a.Map("allmap");this.bm=t;var e=new s.a.Point(102.772465,24.985747);this.bm.centerAndZoom(e,14),this.myDis=new BMapLib.DistanceTool(this.bm),this.convertor=new s.a.Convertor,this.bm.enableScrollWheelZoom(!0),this.bm.addControl(new s.a.MapTypeControl({mapTypes:[BMAP_NORMAL_MAP,BMAP_HYBRID_MAP]}));var n=this;t.addEventListener("dragend",function(){n.points=[],n.allPoints.length&&(n.getCounts(this),n.draw(n.points,n.ploygonStyle))})},Sector1:function(t,e,n,i,l,a,s,o,r,c){var u=[],p=(i-n)/10||10;u.push(t);for(var h=n;h<i+.001;h+=p)u.push(this.EOffsetBearing(t,e,h));return u.push(t),u},EOffsetBearing:function(t,e,n){var i=10*this.bm.getDistance(t,new s.a.Point(t.lng+.1,t.lat)),l=10*this.bm.getDistance(t,new s.a.Point(t.lng,t.lat+.1)),a=e*Math.sin(n*Math.PI/180)/l,o=e*Math.cos(n*Math.PI/180)/i;return new s.a.Point(t.lng+o,t.lat+a)},addMarker:function(){this.getCounts(this.bm),this.draw(this.points,this.ploygonStyle)},setInfoWindow:function(t){var e="";for(var n in t)e+="<p style='margin:0;line-height:20px;font-size:13px;width:250px'><span style='display:inline-block;width:160px'>"+n+":</span>"+t[n]+"</p>";var i='<div style="height: 100px; overflow-y: scroll;margin-top:10px">'+e+"</div>";return new s.a.InfoWindow(i)},removeMarker:function(){this.bm.clearOverlays(),this.points=[]},translateCallback:function(t){0===t.status&&this.bm.centerAndZoom(t.points[0],14)},choiceCell:function(t,e){for(var n=document.querySelectorAll(".cell-item"),i=n.length-1;i>=0;i--)n[i].classList.remove("choiced");t.target.classList.add("choiced");var l=new s.a.Point(e.Longitude,e.Latitude),a=[];a.push(l),this.convertor.translate(a,3,5,this.translateCallback)},getTable:function(){var t=this,e={headers:{username:JSON.parse(sessionStorage.user).username,projectname:sessionStorage.pname,filetype:"map"}};this.$http.post("http://192.168.31.235:2860/api/Geo/GetAllTable?neifiletype=lte",{neifiletype:"lte"},e).then(function(e){t.allPoints=e.allTable.slice(0,1e4),t.planTable=e.planTable})},getCounts:function(t){var e=this;this.bs=t.getBounds(),this.allPoints.forEach(function(t){var n=new s.a.Point(t.Longitude,t.Latitude);e.bs.containsPoint(n)&&e.points.push(t)})},draw:function(t,e){var n=this,i=this.bm,l=t.length,a=l/10+1;if(a>1)for(var o=function(a){for(var o=[],r=[],c=0;c<10;c++)if(10*a+c<l){var u=new s.a.Point(t[10*a+c].Longitude,t[10*a+c].Latitude),p=t[10*a+c];o.push(u),r.push(p)}var h=n;n.convertor.translate(o,1,5,function(t){if(0===t.status)for(var n=function(n){var l=r[n].Dir,a=new s.a.Polygon(h.Sector1(t.points[n],100,90-l-20,90-l+20),e),o=h.setInfoWindow(r[n]);i.addOverlay(a),a.onclick=function(e){i.openInfoWindow(o,new s.a.Point(t.points[n].lng,t.points[n].lat))}},l=0;l<t.points.length;l++)n(l)})},r=0;r<a;r++)o(r)},showNeiplan:function(){this.draw(this.planTable,this.ploygonStyle_1)},getNeiplanResult:function(){var t=this,e={headers:{username:JSON.parse(sessionStorage.user).username,projectname:sessionStorage.pname,filetype:"map"}};this.$http.post("http://192.168.31.235:2860/api/Geo/GetNeighborCell?neifiletype=lte",{servingcell:"713768_02"},e).then(function(e){t.NeiplanResult=e,t.draw(t.NeiplanResult,t.ploygonStyle_2)})}}),computed:l()({},Object(o.e)({user:function(t){return t.user}}),{filterPoints:function(){var t=this;return this.allPoints.filter(function(e){return e.Cell.match(t.cellName.toUpperCase())})},isCell:function(){return 0===this.filterPoints.length}})},c={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"map-wrapper"},[n("div",{staticClass:"map-menu"},[n("p",{staticClass:"cell-list-header"},[t._v("站点列表")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.cellName,expression:"cellName"}],staticClass:"searchCell",attrs:{type:"text",name:"cellName",placeholder:"请输入搜索内容"},domProps:{value:t.cellName},on:{input:function(e){e.target.composing||(t.cellName=e.target.value)}}}),t._v(" "),t.isCell?n("div",{staticClass:"nothingCell"},[t._v("没有找到数据")]):n("ul",{staticClass:"cell-list"},[n("li",[n("h3",{staticStyle:{cursor:"pointer"},on:{click:function(e){t.isShowAllTable=!t.isShowAllTable}}},[t._v("总表")]),t._v(" "),n("ul",{directives:[{name:"show",rawName:"v-show",value:t.isShowAllTable,expression:"isShowAllTable"}],staticClass:"list-item"},t._l(t.filterPoints,function(e){return n("li",{staticClass:"cell-item",on:{click:function(n){t.choiceCell(n,e)}}},[t._v("\n            "+t._s(e.Cell)+"\n          ")])}),0)]),t._v(" "),n("li",[n("h3",{staticStyle:{cursor:"pointer"},on:{click:function(e){t.isShowPlanTable=!t.isShowPlanTable}}},[t._v("邻区规划站点")]),t._v(" "),n("ul",{directives:[{name:"show",rawName:"v-show",value:t.isShowPlanTable,expression:"isShowPlanTable"}],staticClass:"list-item"},t._l(t.planTable,function(e){return n("li",{staticClass:"cell-item",on:{click:function(n){t.choiceCell(n,e)}}},[t._v("\n            "+t._s(e.Cell)+"\n          ")])}),0)])])]),t._v(" "),n("div",{staticClass:"map-content"},[n("div",{staticClass:"toolBar"},[n("div",{staticClass:"neiplan"},[n("button",{on:{click:t.showNeiplan}},[t._v("显示规划点位")]),t._v(" "),n("button",{on:{click:function(e){return e.preventDefault(),t.addMarker(e)}}},[t._v("显示总表")]),t._v(" "),n("button",{on:{click:t.getNeiplanResult}},[t._v("获取邻区规划")])])]),t._v(" "),n("div",{staticStyle:{height:"400px"},attrs:{id:"allmap"}}),t._v(" "),n("button",{staticClass:"rangeBtn",on:{click:function(e){return e.preventDefault(),t.rangeBtn(e)}}},[t._v("测距")]),t._v(" "),n("button",{staticClass:"addMarker",on:{click:function(e){return e.preventDefault(),t.addMarker(e)}}},[t._v("导入数据")]),t._v(" "),n("button",{staticClass:"removeMarker",on:{click:function(e){return e.preventDefault(),t.removeMarker(e)}}},[t._v("删除数据")])])])},staticRenderFns:[]};var u=n("C7Lr")(r,c,!1,function(t){n("5zib")},"data-v-25aba4ac",null);e.default=u.exports}});
//# sourceMappingURL=50.3ad523b79ff3ffcb7bbc.js.map